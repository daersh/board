<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
</head>
<body>
<h2 th:text="${message}">Login Page</h2>

<form id="loginForm">
    <div>
        <label>Email: <input type="text" id="email" placeholder="email"/></label>
        <label>Password: <input type="password" id="password" placeholder="password"/></label>
        <button type="submit">Login</button>
    </div>
</form>

<script th:inline="javascript">
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const data = {
            email: document.getElementById('email').value,
            password: document.getElementById('password').value
        };

        fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
            .then(res => {
                // 1. 응답 상태가 200(OK)인지 확인
                if (res.ok) {
                    // 토큰은 이미 브라우저 쿠키 저장소에 안전하게 들어갔습니다.
                    alert("로그인 성공!");
                    location.href = "/index";
                } else {
                    // 401 Unauthorized 등 에러 처리
                    alert("로그인 실패: 이메일이나 비밀번호를 확인하세요.");
                }
            })
            .catch(err => {
                console.error("네트워크 에러:", err);
                alert("서버와 통신 중 에러가 발생했습니다.");
            });
    });
</script>
</body>
</html>