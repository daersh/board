<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Main Page</title>
</head>
<body>

<div id="authContent">
    <h1 id="welcomeMsg">사용자 정보를 불러오는 중...</h1>
    <button id="logoutBtn">로그아웃</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 사용자 정보 가져오기
        fetch('/api/user/info')
            .then(res => {
                if (!res.ok) throw new Error("인증 실패");
                return res.json();
            })
            .then(user => {
                // 유저 정보 표시 (JwtUtil에서 넣은 nickname 사용)
                document.getElementById('welcomeMsg').innerText =
                    `${user.nickname}님, 환영합니다!`;
            })
            .catch(err => {
                console.error(err);
                alert("로그인이 필요합니다.");
                location.href = "/login";
            });

        // 로그아웃 버튼 이벤트
        document.getElementById('logoutBtn').addEventListener('click', function() {
            fetch('/api/login/logout', { method: 'POST' })
                .then(() => {
                    alert("로그아웃 되었습니다.");
                    location.href = "/login";
                });
        });
    });
</script>

<div th:unless="${isLoggedIn}">
    <p>로그인이 필요합니다. <a href="/login">로그인하러 가기</a></p>
</div>


</body>

</html>